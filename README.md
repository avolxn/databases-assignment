# База данных "Тестирование знаний студентов по выбранной дисциплине"

### Описание представлений (5 Views)

| Представление | Назначение |
|--------------|------------|
| v_StudentsManage | Обновляемое представление для управления студентами (поддерживает INSERT, UPDATE, DELETE через INSTEAD OF триггеры) |
| v_GroupResults | Отчет по успеваемости групп (средний балл) |
| v_FailedStudents | Студенты, не прошедшие тест после 3 попыток |
| v_StudentsNotStarted | Студенты, не приступавшие к тестированию (с указанием группы и факультета) |
| v_StudentsByGroupWithResults | Детальный список студентов по группам с результатами тестирования (включая преподавателя, дату, баллы, статус) |

---

### Описание функций (3 функции)

**Скалярные функции:**
| Функция | Назначение |
|---------|------------|
| fn_CalculateScore | Расчет балла за конкретную попытку на основе правильных ответов |
| fn_CountAttempts | Количество попыток студента по конкретному тесту |

**Табличные функции:**
| Функция | Назначение |
|---------|------------|
| fn_GetStudentHistory | История всех тестов конкретного студента |

---

### Описание хранимых процедур (4 процедуры)

| Процедура | Назначение |
|-----------|------------|
| sp_StartTest | Начать попытку тестирования (TeacherID получается через JOIN с Tests при необходимости) |
| sp_SaveAnswer | Сохранить ответ студента на вопрос |
| sp_FinishTest | Завершить тест и рассчитать итоговый балл |
| sp_GetGroupReport | Отчет по группе (с использованием курсора) |

---

### Описание триггеров (3 триггера)

| Триггер | Назначение |
|---------|------------|
| trg_ProtectFinalizedTest | Запрещает изменение завершенных тестов (AFTER UPDATE на TestAttempts) |
| trg_AutoCheckAnswer | Проверка корректности ответа (принадлежность к вопросу) (AFTER INSERT на StudentAnswers) |
| trg_v_StudentsManage_Delete | Реализация DELETE для обновляемого представления v_StudentsManage (с проверкой истории) |

**Примечание:** Представление `v_StudentsManage` поддерживает UPDATE и INSERT автоматически (без триггеров), так как это простое представление на одной таблице. Триггер для DELETE необходим для добавления бизнес-логики (проверка истории тестирования).

---

### Курсор

**Назначение:** Формирование списка студентов, которые ни разу не приступали к тестированию, с выводом сообщения-напоминания для каждого.

Реализован в процедуре `sp_GetGroupReport` и в примерах использования.

---

### 9. Порядок выполнения скриптов

1. `01_CreateDatabase.sql` - Создание БД и таблиц
2. `02_InsertData.sql` - Заполнение данными
3. `03_Views.sql` - Создание представлений (включая обновляемое представление)
4. `04_Functions.sql` - Создание функций
5. `05_StoredProcedures.sql` - Создание процедур
6. `06_Triggers.sql` - Создание триггеров
7. `09_Tests.sql` - Демонстрация функциональности и тестирование
8. `08_RunAll.sql` - Проверка установки