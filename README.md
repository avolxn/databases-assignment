# База данных "Тестирование знаний студентов по выбранной дисциплине"

### Описание представлений (5 Views)

| Представление | Назначение |
|--------------|------------|
| v_StudentsManage | Обновляемое представление для управления студентами (поддерживает INSERT, UPDATE через INSTEAD OF триггеры; DELETE работает напрямую благодаря CASCADE) |
| v_GroupResults | Отчет по успеваемости групп (средний балл на основе лучших попыток каждого студента) |
| v_FailedStudents | Студенты, не прошедшие тест после 3 попыток |
| v_StudentsNotStarted | Студенты, не приступавшие к тестированию (с указанием группы и факультета) |
| v_StudentsByGroupWithResults | Детальный список студентов по группам с результатами тестирования (включая преподавателя, дату, баллы, статус, номер попытки) |

---

### Описание функций (4 функции)

**Скалярные функции:**
| Функция | Назначение |
|---------|------------|
| fn_CalculateScore | Расчет балла за конкретную попытку на основе правильных ответов |
| fn_CountAttempts | Количество попыток студента по конкретному тесту |
| fn_GetGroupAverageScore | Расчет среднего балла по группе для конкретного теста (на основе лучших попыток каждого студента) |

**Табличные функции:**
| Функция | Назначение |
|---------|------------|
| fn_GetStudentHistory | История всех тестов конкретного студента (с номером попытки и статусом) |

---

### Описание хранимых процедур (6 процедур)

| Процедура | Назначение |
|-----------|------------|
| sp_StartTest | Начать попытку тестирования |
| sp_SaveAnswer | Сохранить ответ студента на вопрос (с проверкой, что тест не завершен) |
| sp_FinishTest | Завершить тест и пометить попытку как завершенную |
| sp_GetGroupReport | Отчет по группе (с использованием курсора) - выводит информацию о каждом студенте группы |
| sp_GetStudentTestHistory | Получить историю тестирования конкретного студента |
| sp_CheckGroupPerformance | Проверить успеваемость группы по тесту (с оценкой статуса) |

---

### Описание триггеров (4 триггера)

| Триггер | Назначение |
|---------|------------|
| trg_ProtectFinalizedTest | Запрещает изменение завершенных тестов (AFTER UPDATE на TestAttempts) |
| trg_AutoCheckAnswer | Проверка корректности ответа (принадлежность к вопросу) (AFTER INSERT на StudentAnswers) |
| trg_v_StudentsManage_Insert | Реализация INSERT для обновляемого представления v_StudentsManage (с проверкой существования группы) |
| trg_v_StudentsManage_Update | Реализация UPDATE для обновляемого представления v_StudentsManage (с проверкой существования группы) |

**Примечание:** DELETE для представления v_StudentsManage работает напрямую благодаря каскадному удалению (CASCADE) в схеме БД.

---

### Курсор

**Назначение:** Формирование списка студентов, которые ни разу не приступали к тестированию, с выводом сообщения-напоминания для каждого.

Реализован в процедуре `sp_GetGroupReport` и в примерах использования.

---

### Порядок выполнения скриптов

1. `00_CreateDatabase.sql` - Создание базы данных
2. `01_CreateTables.sql` - Создание таблиц (11 таблиц)
3. `02_InsertData.sql` - Заполнение данными
4. `03_Functions.sql` - Создание функций (4 функции)
5. `04_Views.sql` - Создание представлений (5 представлений, включая обновляемое)
6. `05_StoredProcedures.sql` - Создание хранимых процедур (6 процедур)
7. `06_Triggers.sql` - Создание триггеров (4 триггера)
8. `07_RunAll.sql` - Проверка установки (опционально)
9. `08_Tests.sql` - Демонстрация функциональности и тестирование