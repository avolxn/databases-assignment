# База данных "Тестирование знаний студентов по выбранной дисциплине"

### Описание представлений (5 Views)

| Представление | Назначение |
|--------------|------------|
| v_StudentsManage | Обновляемое представление для управления студентами (поддерживает INSERT, UPDATE через INSTEAD OF триггеры; DELETE работает напрямую благодаря CASCADE) |
| v_GroupResults | Отчет по успеваемости групп (средний балл) |
| v_FailedStudents | Студенты, не прошедшие тест после 3 попыток |
| v_StudentsNotStarted | Студенты, не приступавшие к тестированию (с указанием группы и факультета) |
| v_StudentsByGroupWithResults | Детальный список студентов по группам с результатами тестирования (включая преподавателя, дату, баллы, статус) |

---

### Описание функций (4 функции)

**Скалярные функции:**
| Функция | Назначение |
|---------|------------|
| fn_CalculateScore | Расчет балла за конкретную попытку на основе правильных ответов |
| fn_CountAttempts | Количество попыток студента по конкретному тесту |
| fn_GetGroupAverageScore | Расчет среднего балла по группе для конкретного теста |

**Табличные функции:**
| Функция | Назначение |
|---------|------------|
| fn_GetStudentHistory | История всех тестов конкретного студента |

---

### Описание хранимых процедур (4 процедуры)

| Процедура | Назначение |
|-----------|------------|
| sp_StartTest | Начать попытку тестирования (TeacherID получается через JOIN с Tests при необходимости) |
| sp_SaveAnswer | Сохранить ответ студента на вопрос |
| sp_FinishTest | Завершить тест и рассчитать итоговый балл |
| sp_GetGroupReport | Отчет по группе (с использованием курсора) |

---

### Описание триггеров (4 триггера)

| Триггер | Назначение |
|---------|------------|
| trg_ProtectFinalizedTest | Запрещает изменение завершенных тестов (AFTER UPDATE на TestAttempts) |
| trg_AutoCheckAnswer | Проверка корректности ответа (принадлежность к вопросу) (AFTER INSERT на StudentAnswers) |
| trg_v_StudentsManage_Insert | Реализация INSERT для обновляемого представления v_StudentsManage (с проверкой существования группы) |
| trg_v_StudentsManage_Update | Реализация UPDATE для обновляемого представления v_StudentsManage (с проверкой существования группы) |

**Примечание:** DELETE для представления v_StudentsManage работает напрямую благодаря каскадному удалению (CASCADE) в схеме БД.

---

### Курсор

**Назначение:** Формирование списка студентов, которые ни разу не приступали к тестированию, с выводом сообщения-напоминания для каждого.

Реализован в процедуре `sp_GetGroupReport` и в примерах использования.

---

### 9. Порядок выполнения скриптов

1. `01_CreateDatabase.sql` - Создание БД и таблиц
2. `02_InsertData.sql` - Заполнение данными
3. `03_Views.sql` - Создание представлений (включая обновляемое представление)
4. `04_Functions.sql` - Создание функций
5. `05_StoredProcedures.sql` - Создание процедур
6. `06_Triggers.sql` - Создание триггеров
7. `07_RunAll.sql` - Проверка установки
8. `08_Tests.sql` - Демонстрация функциональности и тестирование